# Backtest Results API Documentation

This document provides details on the API endpoints available for retrieving backtesting results. The server provides a RESTful interface to access data generated by the backtesting engine.

**Base URL**: `http://127.0.0.1:5000`

---

## 1. Get Available Filters

This endpoint scans the results directory and returns a structured list of all available backtests. This is the primary endpoint to discover what data can be queried.

*   **Endpoint**: `GET /filters`
*   **Description**: Provides a hierarchical view of all completed backtest runs, organized by ticker, interval, and run name. Useful for populating UI selection components.
*   **Query Parameters**: None.

#### Example Request
```http
GET http://127.0.0.1:5000/filters
```

#### Example Success Response (200 OK)
```json
[
  {
    "ticker": "EURUSD=X",
    "intervals": [
      {
        "interval": "5m",
        "runs": [
          {
            "run_name": "run-1",
            "backtest_start_date": "2025-10-20",
            "dates": [
              "2025-10-20",
              "2025-10-21"
            ]
          },
          {
            "run_name": "run-2",
            "backtest_start_date": "2025-10-20",
            "dates": [
              "2025-10-20",
              "2025-10-21"
            ]
          }
        ]
      }
    ]
  }
]
```

---

## 2. Get Run-Level Data

These endpoints retrieve summary data that is generated once for an entire backtest run.

### 2.1 Get Trades

*   **Endpoint**: `GET /trades`
*   **Description**: Retrieves the summary of all active and closed trades, along with the final account balance for a specific backtest run.
*   **Query Parameters**:
    *   `ticker` (string, required): The currency pair or stock symbol (e.g., `EURUSD=X`).
    *   `interval` (string, required): The candle interval (e.g., `5m`).
    *   `run_name` (string, required): The name of the run (e.g., `run-1`).

#### Example Request
```http
GET http://127.0.0.1:5000/trades?ticker=EURUSD=X&interval=5m&run_name=run-1
```

### Example Response (200 OK)
```json
    {
        "options": {
            "start_date": "2025-10-20",
            "end_date": "2025-10-20",
            "interval": "5m",
            "ticker": "EURUSD=X",
            "save_location_base": "test_results",
            "ema_short": 8,
            "ema_long": 34,
            "window": 20,
            "threshold_bb": 0.7,
            "threshold_adx": 20,
            "tolerance": 0.4,
            "loops": 3,
            "results_file_dir": "test_results/EURUSD=X/5m/run-2"
        },
        "active_trades": [
            {
                "entry_id": "6a051bee-9bcd-46a8-856c-7eae0bf45888",
                "ticker": "EURUSD=X",
                "entry_datetime": "2025-10-22T07:20:00+00:00",
                "entry_price": 1.1605,
                "type": "SELL",
                "stop_loss": 1.16184,
                "take_profit": null,
                "size_units": 78313.9154542293,
                "margin_used": 3029.4432961544367,
                "status": "ACTIVE",
                "unrealised_pnl": 126.6448495940331
            }
        ],
        "closed_trades": [
            {
                "entry_id": "6bc075d7-e089-4105-97b1-2a85f5409e79",
                "ticker": "EURUSD=X",
                "entry_datetime": "2025-10-20T14:35:00+00:00",
                "entry_price": 1.16659,
                "type": "BUY",
                "stop_loss": 1.16496,
                "take_profit": null,
                "size_units": 61349.693251532975,
                "margin_used": 2385.6646216768618,
                "closed_datetime": "2025-10-20T17:35:00+00:00",
                "closed_price": 1.16496,
                "profit": -100.0
            }
        ],
        "final_balance": 10494.064670865917
    }
```


### 2.2 Get Equity History

*   **Endpoint**: `GET /equity`
*   **Description**: Retrieves the historical equity data for a specific backtest run. This includes the account equity, balance, and unrealised P/L at each candle.
*   **Query Parameters**:
    *   `ticker` (string, required): The currency pair or stock symbol.
    *   `interval` (string, required): The candle interval.
    *   `run_name` (string, required): The name of the run.

#### Example Request
```http
GET http://127.0.0.1:5000/equity?ticker=EURUSD=X&interval=5m&run_name=run-1
```
### Example Response (200 OK)
```json
[
  {
    "datetime": "2025-10-19T23:05:00+00:00",
    "equity": 10000.0,
    "current_balance": 10000.0,
    "unrealised_pnl": 0.0,
    "max_equity_so_far": 10000.0,
    "min_equity_so_far": 10000.0
  },
]
```

### 2.3 Get Candle Data

*   **Endpoint**: `GET /candles`
*   **Description**: Retrieves all the raw OHLCV candle data that was processed during a specific backtest run.
*   **Query Parameters**:
    *   `ticker` (string, required): The currency pair or stock symbol.
    *   `interval` (string, required): The candle interval.
    *   `run_name` (string, required): The name of the run.

#### Example Request
```http
GET http://127.0.0.1:5000/candles?ticker=EURUSD=X&interval=5m&run_name=run-1
```

#### Response Object 
The response is a CandlesResponse object.

**CandlesResponse Object**:
* `candles` (array of Candle): A list of OHLCV (Open, High, Low, Close, Volume) candle data.

**Candle Object** (inferred):
* `datetime` (string, ISO 8601): The timestamp of the candle (typically the open time).
* `open` (number): The opening price of the candle.
* `high` (number): The highest price reached during the candle's period.
* `low` (number): The lowest price reached during the candle's period.
* `close` (number): The closing price of the candle.
* `volume` (number, optional): The trading volume for the 
```json
candle.{
   [
    {
        "datetime": "2025-10-19T23:00:00+00:00",
        "High": 1.1659088134765625,
        "Low": 1.1657729148864746,
        "Close": 1.1657729148864746,
        "Open": 1.1659088134765625,
        "Volume": 0.0
    },
    {
        "datetime": "2025-10-19T23:05:00+00:00",
        "High": 1.1659088134765625,
        "Low": 1.1659088134765625,
        "Close": 1.1659088134765625,
        "Open": 1.1659088134765625,
        "Volume": 0.0
    },
  ]
}
```

#### Example Error Response (400 Bad Request)
If required parameters are missing for any of the above endpoints.
```json
{
  "error": "Missing required parameters: ticker, interval, run_name"
}
```

#### Example Error Response (404 Not Found)
If the requested data file does not exist.
```json
{
  "error": "Trades data not found for the specified run."
}
```

---

## 3. Get Daily Payload Data

This endpoint retrieves the detailed payloads generated for a single day within a specific backtest run.

*   **Endpoint**: `GET /payloads`
*   **Description**: Retrieves the list of payloads for a specific day. Each payload contains the candle data, calculated conditions, and the decision made by the strategy engine at that point in time.
*   **Query Parameters**:
    *   `ticker` (string, required): The currency pair or stock symbol.
    *   `interval` (string, required): The candle interval.
    *   `run_name` (string, required): The name of the run.
    *   `date` (string, required): The specific date for the payloads in `YYYY-MM-DD` format (e.g., `2025-10-20`).

#### Example Request
```http
GET http://127.0.0.1:5000/payloads?ticker=EURUSD=X&interval=5m&run_name=run-1&date=2025-10-20
```

#### Example Success Response (200 OK)
```json
{
  "options": {
        "start_date": "2025-10-20",
        "end_date": "2025-10-20",
        "interval": "5m",
        "ticker": "EURUSD=X",
        "save_location_base": "test_results",
        "ema_short": 8,
        "ema_long": 34,
        "window": 20,
        "threshold_bb": 0.7,
        "threshold_adx": 20,
        "tolerance": 0.4,
        "loops": 3,
        "results_file_dir": "test_results/EURUSD=X/5m/run-2"
  },
  "payloads": [
        {
            "payload": {
                "strategy_type": "consolidation_breakout",
                "datetime": "2025-10-19T23:00:00+00:00",
                "interval": "5m",
                "candle": {
                    "high": 1.16591,
                    "close": 1.16577,
                    "open": 1.16591,
                    "low": 1.16577,
                    "volume": 0.0
                },
                "ticker": "EURUSD=X",
                "conditions": {
                    "trend_status": "consolidating",
                    "ema_crossover": "none",
                    "candles_since_consolidation": 0,
                    "candles_since_crossover": 1,
                    "consolidation_maxima": 1.16591,
                    "consolidation_minima": 1.16577
                }
            },
            "decision": {
                "action_taken": "NO_ACTION",
                "reason": "Market is in consolidation."
            }
        },
  ]
}
```

#### Example Error Response (404 Not Found)
```json
{
  "error": "Payload data not found for the specified date and run."
}
```