# Database & Models

[‚Üê Back to Core Infrastructure Overview](overview.md)

## Overview
engine uses **Peewee ORM** to interact with the database. It supports PostgreSQL (recommended for production) and SQLite (default for simple setups). The models are defined in `engine/models/`.

## Trading Data Models

### `Candle`
Stores historical OHLCV (Open, High, Low, Close, Volume) data.
- **Fields**: `timestamp`, `open`, `high`, `low`, `close`, `volume`, `exchange`, `symbol`.
- **Usage**: The primary data source for backtesting and live trading.

### `ClosedTrade`
Records completed trades (entry + exit) for reporting and analysis.
- **Fields**: `entry_price`, `exit_price`, `qty`, `pnl`, `opened_at`, `closed_at`, `strategy_name`, `leverage`.
- **Usage**: Generated by the execution engine when a position is closed. Used to calculate metrics like Win Rate and Sharpe Ratio.

### `Order`
Tracks the state of individual orders (Buy/Sell).
- **Fields**: `id`, `price`, `qty`, `type` (MARKET/LIMIT/STOP), `status` (ACTIVE/EXECUTED/CANCELED), `side`, `submitted_at`, `executed_at`.
- **Usage**: Created by strategies, updated by the exchange driver.

### `Trade`
Stores raw trade execution data (ticks) from the exchange.
- **Fields**: `timestamp`, `price`, `buy_qty`, `sell_qty`, `buy_count`, `sell_count`.
- **Usage**: Used for more granular analysis or replaying market moves.

### `Ticker`
Stores snapshots of ticker data (24h stats).
- **Fields**: `timestamp`, `last_price`, `high_price`, `low_price`, `volume`.
- **Usage**: Tracking market state over time.

### `Orderbook`
Stores snapshots of the order book.
- **Fields**: `timestamp`, `data` (Blob/JSON).
- **Usage**: Storing depth data for analysis.

### `DailyBalance`
Tracks the portfolio balance over time.
- **Fields**: `timestamp`, `identifier`, `exchange`, `asset`, `balance`.
- **Usage**: Used to generate the equity curve and calculate daily returns.

## Session Management Models

### `BacktestSession`
Stores the results and state of a backtest session.
- **Fields**: `id`, `status`, `metrics` (JSON), `equity_curve` (JSON), `trades` (JSON), `hyperparameters` (JSON), `strategy_codes`.
- **Usage**: Allows the dashboard to display past backtest results and reload the configuration.

### `MonteCarloSession`
Stores the results of Monte Carlo simulations.
- **Fields**: `id`, `status`, `metrics`, `data`.
- **Usage**: Persisting stress-test results.

### `OptimizationSession`
Stores the results of an optimization run.
- **Fields**: `id`, `status`, `strategy_name`, `best_dna`, `results`.
- **Usage**: Tracking the progress and results of genetic algorithm optimization.

### `Log`
Stores system and strategy logs.
- **Fields**: `id`, `session_id`, `timestamp`, `message`, `type` (INFO/ERROR).
- **Usage**: Debugging and audit trails.

## Configuration & Keys Models

### `Option`
A generic key-value store for system configuration.
- **Fields**: `type`, `json`.
- **Usage**: Stores the global `config` object and other persistent settings.

### `ExchangeApiKeys`
Securely stores API keys for connecting to exchanges.
- **Fields**: `exchange_name`, `name` (label), `api_key`, `api_secret`, `additional_fields`.
- **Usage**: Loaded by the execution engine to authenticate requests.

### `NotificationApiKeys`
Stores credentials for notification services (e.g., Telegram bot token).
- **Fields**: `driver` (Telegram/Discord/Slack), `fields` (JSON).
- **Usage**: Sending alerts to the user.
